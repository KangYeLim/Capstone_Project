<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>하수관 결함 탐지</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"> 마이너스아이콘표시-->

    <link rel = "stylesheet" type ="text/css" href = "style.css">

    <!-- <script>
        window.console = window.console || function(t) {};
    
        if (document.location.search.match(/type=embed/gi)) {
          window.parent.postMessage("resize", "*");
        }
    </script> -->


</head>
<body>
    <div class="head_bg" style="background-image: url('images/background2.png')" ></div>

    <div class="fileupload">
        <h2>검사할 하수도관의 CCTV 이미지파일을 첨부해주세요</h2>       
               
            <!-- 파일 코드 1-->
        <div class="insert">
            <form method="POST" onsubmit="return false;" enctype="multipart/form-data">
                
                <input type="file" onchange="addFile(this);" multiple />
                <input type="submit">
                <div class="file-list"></div>
                
            </form>
        </div>


        <!-- 아이콘 참고-->
        <!-- <i class="bi bi-folder-plus"></i>
        <div class="input-group w-50">
            <span class="input-group-text" id="basic-addon1">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-folder2" viewBox="0 0 16 16">
                    <path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v7a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 1 12.5v-9zM2.5 3a.5.5 0 0 0-.5.5V6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5zM14 7H2v5.5a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5V7z"/>
                </svg>
            </span>
            <input type="text" class="form-control" placeholder="Input group example" aria-label="Input group example" aria-describedby="basic-addon1">
        </div> -->

        <a href="fileUproad.html" class="btn btn-light btn-lg">결함 탐지하기</a>
        <br>
        <br>
        <br>
        <hr> 
    </div>


  

    <!-- 2파일 코드2 참고-->
    <!-- <form action="http://localhost/upload.php" method="post" enctype="multipart/form-data">
        <input multiple="multiple"  type="file" name="filename[]" />
        <input type="submit">
    </form> -->

    
    <!-- 본문 -->
    <!-- <main class="mb-4">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <h2>검사할 하수도관의 CCTV 이미지파일을 첨부해주세요</h2>
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Saepe nostrum ullam eveniet pariatur voluptates odit, fuga atque ea nobis sit soluta odio, adipisci quas excepturi maxime quae totam ducimus consectetur?</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius praesentium recusandae illo eaque architecto error, repellendus iusto reprehenderit, doloribus, minus sunt. Numquam at quae voluptatum in officia voluptas voluptatibus, minus!</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aut consequuntur magnam, excepturi aliquid ex itaque esse est vero natus quae optio aperiam soluta voluptatibus corporis atque iste neque sit tempora!</p>
                </div>
            </div>
        </div>
    </main> -->

    <script>

        var selFile = document.querySelector("input[type=file]");
      
        /* 첨부파일 추가 */
        function addFile(obj){
          var maxFileCnt = 5; // 첨부파일 최대 개수
          var curFileCnt = obj.files.length; // 현재 선택된 첨부파일 개수

          var files = obj.files;
          let htmlData = '';
      
      
            if (curFileCnt > maxFileCnt) {
              alert("첨부파일은 최대 " + maxFileCnt + "개 까지 첨부 가능합니다.\n개수에 맞춰 다시 선택해주세요.");
              document.querySelector('.file-list').innerHTML = htmlData;
            } 
            else {
                
                for (var i = 0; i < files.length; i++) {
                    const file = files[i];
                    // 목록 추가
                    htmlData += '<div id="file' + i + '" class="filebox">';
                    htmlData += '   <p class="name">' + file.name + '</p>';
                    htmlData += '   <a class="delete" onclick="jsFunc.deleteFile(' + i + ');"><i class="far fa-minus-square"></i></a>';
                    htmlData += '</div>';
                }
                document.querySelector('.file-list').innerHTML = htmlData;
            }
        }
      
        /* 첨부파일 삭제 */
        function deleteFile(num) {
            var dt = new DataTransfer()
            var { files } = selFile;
      
            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                if (num !== i) dt.items.add(file);
                selFile.files = dt.files;
            }
      
            document.querySelector("#file" + num).remove();
        }
      
       
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<!-- 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cpwebassets.codepen.io/assets/common/stopExecutionOnTimeout-1b93190375e9ccc259df3a57c1abc0e64599724ae30d7ea4c6877eb615f89387.js"></script>

    <script>
       
        var fileNo=0;      //이게없으면 파일개수가 출력되나 파일박스에 리스트가 없음
        var filesArr = new Array();

        /* 첨부파일 추가 */
        function addFile(obj){
            var maxFileCnt = 5;   // 첨부파일 최대 개수
            var attFileCnt = document.querySelectorAll('.filebox').length;    // 기존 추가된 첨부파일 개수
            var remainFileCnt = maxFileCnt - attFileCnt;    // 추가로 첨부가능한 개수
            var curFileCnt = obj.files.length;  // 현재 선택된 첨부파일 개수

            // 첨부파일 개수 확인
            if (curFileCnt > remainFileCnt) {
                alert("첨부파일은 최대 " + maxFileCnt + "개 까지 첨부 가능합니다.");
            } else {
                for (const file of obj.files) {
                    // 첨부파일 검증
                    if (validation(file)) {
                        // 파일 배열에 담기
                        var reader = new FileReader();
                        reader.onload = function () {
                            filesArr.push(file);
                        };
                        reader.readAsDataURL(file);

                        // 목록 추가
                        let htmlData = '';
                        htmlData += '<div id="file' + fileNo + '" class="filebox">';
                        htmlData += '   <p class="name">' + file.name + '</p>';
                        htmlData += '   <a class="delete" onclick="deleteFile(' + fileNo + ');"><i class="far fa-minus-square"></i></a>';
                        htmlData += '</div>';
                        $('.file-list').append(htmlData);
                        fileNo++;
                    } else {
                        continue;
                    }
                }
            }
            // 초기화
            document.querySelector("input[type=file]").value = "";
        }

        /* 첨부파일 검증 */
        function validation(obj){
            const fileTypes = ['application/pdf', 'image/gif', 'image/jpeg', 'image/png', 'image/bmp', 'image/tif', 'application/haansofthwp', 'application/x-hwp'];
            if (obj.name.length > 100) {
                alert("파일명이 100자 이상인 파일은 제외되었습니다.");
                return false;
            } else if (obj.size > (100 * 1024 * 1024)) {
                alert("최대 파일 용량인 100MB를 초과한 파일은 제외되었습니다.");
                return false;
            } else if (obj.name.lastIndexOf('.') == -1) {
                alert("확장자가 없는 파일은 제외되었습니다.");
                return false;
            } else if (!fileTypes.includes(obj.type)) {
                alert("첨부가 불가능한 파일은 제외되었습니다.");
                return false;
            } else {
                return true;
            }
        }

        /* 첨부파일 삭제 */
        function deleteFile(num) {
            document.querySelector("#file" + num).remove();
            filesArr[num].is_delete = true;
        }

        /* 폼 전송 */
        function submitForm() {
            // 폼데이터 담기
            var form = document.querySelector("form");
            var formData = new FormData(form);
            for (var i = 0; i < filesArr.length; i++) {
                // 삭제되지 않은 파일만 폼데이터에 담기
                if (!filesArr[i].is_delete) {
                    formData.append("attach_file", filesArr[i]);
                }
            }

            $.ajax({
                method: 'POST',
                url: '/register',
                dataType: 'json',
                data: formData,
                async: true,
                timeout: 30000,
                cache: false,
                headers: {'cache-control': 'no-cache', 'pragma': 'no-cache'},
                success: function () {
                    alert("파일업로드 성공");
                },
                error: function (xhr, desc, err) {
                    alert('에러가 발생 하였습니다.');
                    return;
                }
            })
        }
    </script> -->
</body>
</html>